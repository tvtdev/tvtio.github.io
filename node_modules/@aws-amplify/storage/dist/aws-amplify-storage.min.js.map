{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///external \"@aws-amplify/core\"","webpack:///external \"aws-sdk/clients/s3\"","webpack:///./lib-esm/Providers/AWSS3Provider.js","webpack:///./lib-esm/Storage.js","webpack:///./lib-esm/index.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__1__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__assign","arguments","__awaiter","thisArg","_arguments","P","generator","resolve","reject","step","e","result","adopt","__generator","body","_","label","sent","trys","ops","g","next","verb","v","TypeError","f","y","op","done","logger","AMPLIFY_SYMBOL","dispatchStorageEvent","Hub","event","data","attrs","metrics","message","config","AWSS3Provider","amplifyConfig","Parser","_config","_a","credentialsOK","opt","bucket","download","track","expires","prefix","_prefix","final_key","s3","_createS3","params","Bucket","Key","Promise","res","rej","err","method","fileSize","Number","url","progressCallback","contentType","contentDisposition","cacheControl","metadata","tagging","serverSideEncryption","SSECustomerAlgorithm","SSECustomerKey","SSECustomerKeyMD5","SSEKMSKeyId","type","Body","ContentType","progress","e_1","path","final_path","Prefix","list","item","eTag","lastModified","size","Size","_this","credentials","cred","Credentials","level","customPrefix","identityId","privatePath","protectedPath","publicPath","region","localTestingConfig","endpoint","s3BucketEndpoint","s3ForcePathStyle","apiVersion","signatureVersion","put","remove","StorageClass","pluggable","providerName","_pluggables","find","filter","storageKeysFromConfig","storageArrayKeys","isInStorageArrayKeys","x","k","length","_b","provider","prov","_instance","old_configure_1","options","vaultConfig","Storage","Amplify"],"mappings":"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","file":"aws-amplify-storage.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@aws-amplify/core\"), require(\"aws-sdk/clients/s3\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"aws_amplify_storage\", [\"@aws-amplify/core\", \"aws-sdk/clients/s3\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"aws_amplify_storage\"] = factory(require(\"@aws-amplify/core\"), require(\"aws-sdk/clients/s3\"));\n\telse\n\t\troot[\"aws_amplify_storage\"] = factory(root[\"@aws-amplify/core\"], root[\"aws-sdk/clients/s3\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE__0__, __WEBPACK_EXTERNAL_MODULE__1__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nimport { ConsoleLogger as Logger, Hub, Credentials, Parser, } from '@aws-amplify/core';\nimport * as S3 from 'aws-sdk/clients/s3';\nvar logger = new Logger('AWSS3Provider');\nvar AMPLIFY_SYMBOL = (typeof Symbol !== 'undefined' &&\n    typeof Symbol.for === 'function'\n    ? Symbol.for('amplify_default')\n    : '@@amplify_default');\nvar dispatchStorageEvent = function (track, event, attrs, metrics, message) {\n    if (track) {\n        Hub.dispatch('storage', {\n            event: event,\n            data: { attrs: attrs, metrics: metrics },\n            message: message,\n        }, 'Storage', AMPLIFY_SYMBOL);\n    }\n};\nvar localTestingStorageEndpoint = 'http://localhost:20005';\n/**\n * Provide storage methods to use AWS S3\n */\nvar AWSS3Provider = /** @class */ (function () {\n    /**\n     * Initialize Storage with AWS configurations\n     * @param {Object} config - Configuration object for storage\n     */\n    function AWSS3Provider(config) {\n        this._config = config ? config : {};\n        logger.debug('Storage Options', this._config);\n    }\n    /**\n     * get the category of the plugin\n     */\n    AWSS3Provider.prototype.getCategory = function () {\n        return AWSS3Provider.CATEGORY;\n    };\n    /**\n     * get provider name of the plugin\n     */\n    AWSS3Provider.prototype.getProviderName = function () {\n        return AWSS3Provider.PROVIDER_NAME;\n    };\n    /**\n     * Configure Storage part with aws configuration\n     * @param {Object} config - Configuration of the Storage\n     * @return {Object} - Current configuration\n     */\n    AWSS3Provider.prototype.configure = function (config) {\n        logger.debug('configure Storage', config);\n        if (!config)\n            return this._config;\n        var amplifyConfig = Parser.parseMobilehubConfig(config);\n        this._config = Object.assign({}, this._config, amplifyConfig.Storage);\n        if (!this._config.bucket) {\n            logger.debug('Do not have bucket yet');\n        }\n        return this._config;\n    };\n    /**\n     * Get a presigned URL of the file or the object data when download:true\n     *\n     * @param {String} key - key of the object\n     * @param {Object} [config] - { level : private|protected|public, download: true|false }\n     * @return - A promise resolves to Amazon S3 presigned URL on success\n     */\n    AWSS3Provider.prototype.get = function (key, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var credentialsOK, opt, bucket, download, track, expires, prefix, final_key, s3, params;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._ensureCredentials()];\n                    case 1:\n                        credentialsOK = _a.sent();\n                        if (!credentialsOK) {\n                            return [2 /*return*/, Promise.reject('No credentials')];\n                        }\n                        opt = Object.assign({}, this._config, config);\n                        bucket = opt.bucket, download = opt.download, track = opt.track, expires = opt.expires;\n                        prefix = this._prefix(opt);\n                        final_key = prefix + key;\n                        s3 = this._createS3(opt);\n                        logger.debug('get ' + key + ' from ' + final_key);\n                        params = {\n                            Bucket: bucket,\n                            Key: final_key,\n                        };\n                        if (download === true) {\n                            return [2 /*return*/, new Promise(function (res, rej) {\n                                    s3.getObject(params, function (err, data) {\n                                        if (err) {\n                                            dispatchStorageEvent(track, 'download', {\n                                                method: 'get',\n                                                result: 'failed',\n                                            }, null, \"Download failed with \" + err.message);\n                                            rej(err);\n                                        }\n                                        else {\n                                            dispatchStorageEvent(track, 'download', { method: 'get', result: 'success' }, { fileSize: Number(data.Body['length']) }, \"Download success for \" + key);\n                                            res(data);\n                                        }\n                                    });\n                                })];\n                        }\n                        if (expires) {\n                            params.Expires = expires;\n                        }\n                        return [2 /*return*/, new Promise(function (res, rej) {\n                                try {\n                                    var url = s3.getSignedUrl('getObject', params);\n                                    dispatchStorageEvent(track, 'getSignedUrl', { method: 'get', result: 'success' }, null, \"Signed URL: \" + url);\n                                    res(url);\n                                }\n                                catch (e) {\n                                    logger.warn('get signed url error', e);\n                                    dispatchStorageEvent(track, 'getSignedUrl', { method: 'get', result: 'failed' }, null, \"Could not get a signed URL for \" + key);\n                                    rej(e);\n                                }\n                            })];\n                }\n            });\n        });\n    };\n    /**\n     * Put a file in S3 bucket specified to configure method\n     * @param {String} key - key of the object\n     * @param {Object} object - File to be put in Amazon S3 bucket\n     * @param {Object} [config] - { level : private|protected|public, contentType: MIME Types,\n     *  progressCallback: function }\n     * @return - promise resolves to object on success\n     */\n    AWSS3Provider.prototype.put = function (key, object, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var credentialsOK, opt, bucket, track, progressCallback, contentType, contentDisposition, cacheControl, expires, metadata, tagging, serverSideEncryption, SSECustomerAlgorithm, SSECustomerKey, SSECustomerKeyMD5, SSEKMSKeyId, type, prefix, final_key, s3, params, upload, data, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._ensureCredentials()];\n                    case 1:\n                        credentialsOK = _a.sent();\n                        if (!credentialsOK) {\n                            return [2 /*return*/, Promise.reject('No credentials')];\n                        }\n                        opt = Object.assign({}, this._config, config);\n                        bucket = opt.bucket, track = opt.track, progressCallback = opt.progressCallback;\n                        contentType = opt.contentType, contentDisposition = opt.contentDisposition, cacheControl = opt.cacheControl, expires = opt.expires, metadata = opt.metadata, tagging = opt.tagging;\n                        serverSideEncryption = opt.serverSideEncryption, SSECustomerAlgorithm = opt.SSECustomerAlgorithm, SSECustomerKey = opt.SSECustomerKey, SSECustomerKeyMD5 = opt.SSECustomerKeyMD5, SSEKMSKeyId = opt.SSEKMSKeyId;\n                        type = contentType ? contentType : 'binary/octet-stream';\n                        prefix = this._prefix(opt);\n                        final_key = prefix + key;\n                        s3 = this._createS3(opt);\n                        logger.debug('put ' + key + ' to ' + final_key);\n                        params = {\n                            Bucket: bucket,\n                            Key: final_key,\n                            Body: object,\n                            ContentType: type,\n                        };\n                        if (cacheControl) {\n                            params.CacheControl = cacheControl;\n                        }\n                        if (contentDisposition) {\n                            params.ContentDisposition = contentDisposition;\n                        }\n                        if (expires) {\n                            params.Expires = expires;\n                        }\n                        if (metadata) {\n                            params.Metadata = metadata;\n                        }\n                        if (tagging) {\n                            params.Tagging = tagging;\n                        }\n                        if (serverSideEncryption) {\n                            params.ServerSideEncryption = serverSideEncryption;\n                            if (SSECustomerAlgorithm) {\n                                params.SSECustomerAlgorithm = SSECustomerAlgorithm;\n                            }\n                            if (SSECustomerKey) {\n                                params.SSECustomerKey = SSECustomerKey;\n                            }\n                            if (SSECustomerKeyMD5) {\n                                params.SSECustomerKeyMD5 = SSECustomerKeyMD5;\n                            }\n                            if (SSEKMSKeyId) {\n                                params.SSEKMSKeyId = SSEKMSKeyId;\n                            }\n                        }\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 5]);\n                        upload = s3.upload(params).on('httpUploadProgress', function (progress) {\n                            if (progressCallback) {\n                                if (typeof progressCallback === 'function') {\n                                    progressCallback(progress);\n                                }\n                                else {\n                                    logger.warn('progressCallback should be a function, not a ' +\n                                        typeof progressCallback);\n                                }\n                            }\n                        });\n                        return [4 /*yield*/, upload.promise()];\n                    case 3:\n                        data = _a.sent();\n                        logger.debug('upload result', data);\n                        dispatchStorageEvent(track, 'upload', { method: 'put', result: 'success' }, null, \"Upload success for \" + key);\n                        return [2 /*return*/, {\n                                key: data.Key.substr(prefix.length),\n                            }];\n                    case 4:\n                        e_1 = _a.sent();\n                        logger.warn('error uploading', e_1);\n                        dispatchStorageEvent(track, 'upload', { method: 'put', result: 'failed' }, null, \"Error uploading \" + key);\n                        throw e_1;\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Remove the object for specified key\n     * @param {String} key - key of the object\n     * @param {Object} [config] - { level : private|protected|public }\n     * @return - Promise resolves upon successful removal of the object\n     */\n    AWSS3Provider.prototype.remove = function (key, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var credentialsOK, opt, bucket, track, prefix, final_key, s3, params;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._ensureCredentials()];\n                    case 1:\n                        credentialsOK = _a.sent();\n                        if (!credentialsOK) {\n                            return [2 /*return*/, Promise.reject('No credentials')];\n                        }\n                        opt = Object.assign({}, this._config, config);\n                        bucket = opt.bucket, track = opt.track;\n                        prefix = this._prefix(opt);\n                        final_key = prefix + key;\n                        s3 = this._createS3(opt);\n                        logger.debug('remove ' + key + ' from ' + final_key);\n                        params = {\n                            Bucket: bucket,\n                            Key: final_key,\n                        };\n                        return [2 /*return*/, new Promise(function (res, rej) {\n                                s3.deleteObject(params, function (err, data) {\n                                    if (err) {\n                                        dispatchStorageEvent(track, 'delete', { method: 'remove', result: 'failed' }, null, \"Deletion of \" + key + \" failed with \" + err);\n                                        rej(err);\n                                    }\n                                    else {\n                                        dispatchStorageEvent(track, 'delete', { method: 'remove', result: 'success' }, null, \"Deleted \" + key + \" successfully\");\n                                        res(data);\n                                    }\n                                });\n                            })];\n                }\n            });\n        });\n    };\n    /**\n     * List bucket objects relative to the level and prefix specified\n     * @param {String} path - the path that contains objects\n     * @param {Object} [config] - { level : private|protected|public }\n     * @return - Promise resolves to list of keys for all objects in path\n     */\n    AWSS3Provider.prototype.list = function (path, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var credentialsOK, opt, bucket, track, prefix, final_path, s3, params;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._ensureCredentials()];\n                    case 1:\n                        credentialsOK = _a.sent();\n                        if (!credentialsOK) {\n                            return [2 /*return*/, Promise.reject('No credentials')];\n                        }\n                        opt = Object.assign({}, this._config, config);\n                        bucket = opt.bucket, track = opt.track;\n                        prefix = this._prefix(opt);\n                        final_path = prefix + path;\n                        s3 = this._createS3(opt);\n                        logger.debug('list ' + path + ' from ' + final_path);\n                        params = {\n                            Bucket: bucket,\n                            Prefix: final_path,\n                        };\n                        return [2 /*return*/, new Promise(function (res, rej) {\n                                s3.listObjects(params, function (err, data) {\n                                    if (err) {\n                                        logger.warn('list error', err);\n                                        dispatchStorageEvent(track, 'list', { method: 'list', result: 'failed' }, null, \"Listing items failed: \" + err.message);\n                                        rej(err);\n                                    }\n                                    else {\n                                        var list = data.Contents.map(function (item) {\n                                            return {\n                                                key: item.Key.substr(prefix.length),\n                                                eTag: item.ETag,\n                                                lastModified: item.LastModified,\n                                                size: item.Size,\n                                            };\n                                        });\n                                        dispatchStorageEvent(track, 'list', { method: 'list', result: 'success' }, null, list.length + \" items returned from list operation\");\n                                        logger.debug('list', list);\n                                        res(list);\n                                    }\n                                });\n                            })];\n                }\n            });\n        });\n    };\n    /**\n     * @private\n     */\n    AWSS3Provider.prototype._ensureCredentials = function () {\n        var _this = this;\n        return Credentials.get()\n            .then(function (credentials) {\n            if (!credentials)\n                return false;\n            var cred = Credentials.shear(credentials);\n            logger.debug('set credentials for storage', cred);\n            _this._config.credentials = cred;\n            return true;\n        })\n            .catch(function (err) {\n            logger.warn('ensure credentials error', err);\n            return false;\n        });\n    };\n    /**\n     * @private\n     */\n    AWSS3Provider.prototype._prefix = function (config) {\n        var credentials = config.credentials, level = config.level;\n        var customPrefix = config.customPrefix || {};\n        var identityId = config.identityId || credentials.identityId;\n        var privatePath = (customPrefix.private !== undefined ? customPrefix.private : 'private/') +\n            identityId +\n            '/';\n        var protectedPath = (customPrefix.protected !== undefined\n            ? customPrefix.protected\n            : 'protected/') +\n            identityId +\n            '/';\n        var publicPath = customPrefix.public !== undefined ? customPrefix.public : 'public/';\n        switch (level) {\n            case 'private':\n                return privatePath;\n            case 'protected':\n                return protectedPath;\n            default:\n                return publicPath;\n        }\n    };\n    /**\n     * @private\n     */\n    AWSS3Provider.prototype._createS3 = function (config) {\n        var bucket = config.bucket, region = config.region, credentials = config.credentials, dangerouslyConnectToHttpEndpointForTesting = config.dangerouslyConnectToHttpEndpointForTesting;\n        var localTestingConfig = {};\n        if (dangerouslyConnectToHttpEndpointForTesting) {\n            localTestingConfig = {\n                endpoint: localTestingStorageEndpoint,\n                s3BucketEndpoint: true,\n                s3ForcePathStyle: true,\n            };\n        }\n        return new S3(__assign({ apiVersion: '2006-03-01', params: { Bucket: bucket }, signatureVersion: 'v4', region: region,\n            credentials: credentials }, localTestingConfig));\n    };\n    AWSS3Provider.CATEGORY = 'Storage';\n    AWSS3Provider.PROVIDER_NAME = 'AWSS3';\n    return AWSS3Provider;\n}());\nexport default AWSS3Provider;\n//# sourceMappingURL=AWSS3Provider.js.map","/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { ConsoleLogger as Logger, Parser } from '@aws-amplify/core';\nimport AWSS3Provider from './Providers/AWSS3Provider';\nvar logger = new Logger('StorageClass');\nvar DEFAULT_PROVIDER = 'AWSS3';\n/**\n * Provide storage methods to use AWS S3\n */\nvar StorageClass = /** @class */ (function () {\n    /**\n     * Initialize Storage\n     * @param {Object} config - Configuration object for storage\n     */\n    function StorageClass() {\n        this._config = {};\n        this._pluggables = [];\n        logger.debug('Storage Options', this._config);\n        this.get = this.get.bind(this);\n        this.put = this.put.bind(this);\n        this.remove = this.remove.bind(this);\n        this.list = this.list.bind(this);\n    }\n    StorageClass.prototype.getModuleName = function () {\n        return 'Storage';\n    };\n    /**\n     * add plugin into Storage category\n     * @param {Object} pluggable - an instance of the plugin\n     */\n    StorageClass.prototype.addPluggable = function (pluggable) {\n        if (pluggable && pluggable.getCategory() === 'Storage') {\n            this._pluggables.push(pluggable);\n            var config = {};\n            config = pluggable.configure(this._config[pluggable.getProviderName()]);\n            return config;\n        }\n    };\n    /**\n     * Get the plugin object\n     * @param providerName - the name of the plugin\n     */\n    StorageClass.prototype.getPluggable = function (providerName) {\n        var pluggable = this._pluggables.find(function (pluggable) { return pluggable.getProviderName() === providerName; });\n        if (pluggable === undefined) {\n            logger.debug('No plugin found with providerName', providerName);\n            return null;\n        }\n        else\n            return pluggable;\n    };\n    /**\n     * Remove the plugin object\n     * @param providerName - the name of the plugin\n     */\n    StorageClass.prototype.removePluggable = function (providerName) {\n        this._pluggables = this._pluggables.filter(function (pluggable) { return pluggable.getProviderName() !== providerName; });\n        return;\n    };\n    /**\n     * Configure Storage\n     * @param {Object} config - Configuration object for storage\n     * @return {Object} - Current configuration\n     */\n    StorageClass.prototype.configure = function (config) {\n        var _this = this;\n        logger.debug('configure Storage');\n        if (!config)\n            return this._config;\n        var amplifyConfig = Parser.parseMobilehubConfig(config);\n        var storageKeysFromConfig = Object.keys(amplifyConfig.Storage);\n        var storageArrayKeys = [\n            'bucket',\n            'region',\n            'level',\n            'track',\n            'customPrefix',\n            'serverSideEncryption',\n            'SSECustomerAlgorithm',\n            'SSECustomerKey',\n            'SSECustomerKeyMD5',\n            'SSEKMSKeyId',\n        ];\n        var isInStorageArrayKeys = function (k) {\n            return storageArrayKeys.some(function (x) { return x === k; });\n        };\n        var checkConfigKeysFromArray = function (k) {\n            return k.find(function (k) { return isInStorageArrayKeys(k); });\n        };\n        if (storageKeysFromConfig &&\n            checkConfigKeysFromArray(storageKeysFromConfig) &&\n            !amplifyConfig.Storage[DEFAULT_PROVIDER]) {\n            amplifyConfig.Storage[DEFAULT_PROVIDER] = {};\n        }\n        Object.entries(amplifyConfig.Storage).map(function (_a) {\n            var key = _a[0], value = _a[1];\n            if (key && isInStorageArrayKeys(key) && value !== undefined) {\n                amplifyConfig.Storage[DEFAULT_PROVIDER][key] = value;\n                delete amplifyConfig.Storage[key];\n            }\n        });\n        // only update new values for each provider\n        Object.keys(amplifyConfig.Storage).forEach(function (providerName) {\n            if (typeof amplifyConfig.Storage[providerName] !== 'string') {\n                _this._config[providerName] = __assign(__assign({}, _this._config[providerName]), amplifyConfig.Storage[providerName]);\n            }\n        });\n        this._pluggables.forEach(function (pluggable) {\n            pluggable.configure(_this._config[pluggable.getProviderName()]);\n        });\n        if (this._pluggables.length === 0) {\n            this.addPluggable(new AWSS3Provider());\n        }\n        return this._config;\n    };\n    /**\n     * Get a presigned URL of the file or the object data when download:true\n     *\n     * @param {String} key - key of the object\n     * @param {Object} [config] - { level : private|protected|public, download: true|false }\n     * @return - A promise resolves to either a presigned url or the object\n     */\n    StorageClass.prototype.get = function (key, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, provider, prov;\n            return __generator(this, function (_b) {\n                _a = (config || {}).provider, provider = _a === void 0 ? DEFAULT_PROVIDER : _a;\n                prov = this._pluggables.find(function (pluggable) { return pluggable.getProviderName() === provider; });\n                if (prov === undefined) {\n                    logger.debug('No plugin found with providerName', provider);\n                    Promise.reject('No plugin found in Storage for the provider');\n                }\n                return [2 /*return*/, prov.get(key, config)];\n            });\n        });\n    };\n    /**\n     * Put a file in storage bucket specified to configure method\n     * @param {String} key - key of the object\n     * @param {Object} object - File to be put in bucket\n     * @param {Object} [config] - { level : private|protected|public, contentType: MIME Types,\n     *  progressCallback: function }\n     * @return - promise resolves to object on success\n     */\n    StorageClass.prototype.put = function (key, object, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, provider, prov;\n            return __generator(this, function (_b) {\n                _a = (config || {}).provider, provider = _a === void 0 ? DEFAULT_PROVIDER : _a;\n                prov = this._pluggables.find(function (pluggable) { return pluggable.getProviderName() === provider; });\n                if (prov === undefined) {\n                    logger.debug('No plugin found with providerName', provider);\n                    Promise.reject('No plugin found in Storage for the provider');\n                }\n                return [2 /*return*/, prov.put(key, object, config)];\n            });\n        });\n    };\n    /**\n     * Remove the object for specified key\n     * @param {String} key - key of the object\n     * @param {Object} [config] - { level : private|protected|public }\n     * @return - Promise resolves upon successful removal of the object\n     */\n    StorageClass.prototype.remove = function (key, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, provider, prov;\n            return __generator(this, function (_b) {\n                _a = (config || {}).provider, provider = _a === void 0 ? DEFAULT_PROVIDER : _a;\n                prov = this._pluggables.find(function (pluggable) { return pluggable.getProviderName() === provider; });\n                if (prov === undefined) {\n                    logger.debug('No plugin found with providerName', provider);\n                    Promise.reject('No plugin found in Storage for the provider');\n                }\n                return [2 /*return*/, prov.remove(key, config)];\n            });\n        });\n    };\n    /**\n     * List bucket objects relative to the level and prefix specified\n     * @param {String} path - the path that contains objects\n     * @param {Object} [config] - { level : private|protected|public }\n     * @return - Promise resolves to list of keys for all objects in path\n     */\n    StorageClass.prototype.list = function (path, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, provider, prov;\n            return __generator(this, function (_b) {\n                _a = (config || {}).provider, provider = _a === void 0 ? DEFAULT_PROVIDER : _a;\n                prov = this._pluggables.find(function (pluggable) { return pluggable.getProviderName() === provider; });\n                if (prov === undefined) {\n                    logger.debug('No plugin found with providerName', provider);\n                    Promise.reject('No plugin found in Storage for the provider');\n                }\n                return [2 /*return*/, prov.list(path, config)];\n            });\n        });\n    };\n    return StorageClass;\n}());\nexport default StorageClass;\n//# sourceMappingURL=Storage.js.map","/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport StorageClass from './Storage';\nimport Amplify, { ConsoleLogger as Logger } from '@aws-amplify/core';\nvar logger = new Logger('Storage');\nvar _instance = null;\nif (!_instance) {\n    logger.debug('Create Storage Instance');\n    _instance = new StorageClass();\n    _instance.vault = new StorageClass();\n    var old_configure_1 = _instance.configure;\n    _instance.configure = function (options) {\n        logger.debug('storage configure called');\n        var vaultConfig = __assign({}, old_configure_1.call(_instance, options));\n        // set level private for each provider for the vault\n        Object.keys(vaultConfig).forEach(function (providerName) {\n            if (typeof vaultConfig[providerName] !== 'string') {\n                vaultConfig[providerName] = __assign(__assign({}, vaultConfig[providerName]), { level: 'private' });\n            }\n        });\n        logger.debug('storage vault configure called');\n        _instance.vault.configure(vaultConfig);\n    };\n}\nvar Storage = _instance;\nAmplify.register(Storage);\nexport default Storage;\nexport { StorageClass };\nexport * from './Providers';\n//# sourceMappingURL=index.js.map"],"sourceRoot":""}